Script started on 2023-04-12 10:37:10+07:00 [TERM="xterm" TTY="/dev/pts/0" COLUMNS="172" LINES="40"]
]0;garik@garik-VirtualBox: ~/VG/CentOS1garik@garik-VirtualBox:~/VG/CentOS1$ vagrant up
[0mBringing machine 'lvm' up with 'virtualbox' provider...[0m
[1m==> lvm: Clearing any previously set forwarded ports...[0m
[1m==> lvm: Clearing any previously set network interfaces...[0m
[1m==> lvm: Preparing network interfaces based on configuration...[0m
[0m    lvm: Adapter 1: nat[0m
[0m    lvm: Adapter 2: hostonly[0m
[1m==> lvm: Forwarding ports...[0m
[0m    lvm: 22 (guest) => 2222 (host) (adapter 1)[0m
[1m==> lvm: Running 'pre-boot' VM customizations...[0m
[1m==> lvm: Booting VM...[0m
[1m==> lvm: Waiting for machine to boot. This may take a few minutes...[0m
[0m    lvm: SSH address: 127.0.0.1:2222[0m
[0m    lvm: SSH username: vagrant[0m
[0m    lvm: SSH auth method: private key[0m
[1m==> lvm: Machine booted and ready![0m
[1m==> lvm: Checking for guest additions in VM...[0m
[0m    lvm: No guest additions were detected on the base box for this VM! Guest
    lvm: additions are required for forwarded ports, shared folders, host only
    lvm: networking, and more. If SSH fails on this machine, please install
    lvm: the guest additions and repackage the box to continue.
    lvm: 
    lvm: This is not an error message; everything may continue to work properly,
    lvm: in which case you may ignore this message.[0m
[1m==> lvm: Setting hostname...[0m
[1m==> lvm: Configuring and enabling network interfaces...[0m
[1m==> lvm: Rsyncing folder: /home/garik/VG/CentOS1/ => /vagrant[0m
[1m==> lvm: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> lvm: flag to force provisioning. Provisioners marked to run always will still run.[0m
]0;garik@garik-VirtualBox: ~/VG/CentOS1garik@garik-VirtualBox:~/VG/CentOS1$ vagrant ssh
Last login: Wed Apr 12 03:29:56 2023 from 10.0.2.2
]0;vagrant@lvm:~[?1034h[vagrant@lvm ~]$ sudo -i
]0;root@lvm:~[?1034h[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
â”œâ”€sda1                    8:1    0    1M  0 part 
â”œâ”€sda2                    8:2    0    1G  0 part /boot
â””â”€sda3                    8:3    0   39G  0 part 
  â”œâ”€VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  â””â”€VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
]0;root@lvm:~[root@lvm ~]# lvmdiskscan
  /dev/VolGroup00/LogVol00 [     <37.47 GiB] 
  /dev/VolGroup00/LogVol01 [       1.50 GiB] 
  /dev/sda2                [       1.00 GiB] 
  /dev/sda3                [     <39.00 GiB] LVM physical volume
  /dev/sdb                 [      10.00 GiB] 
  /dev/sdc                 [       2.00 GiB] 
  /dev/sdd                 [       1.00 GiB] 
  /dev/sde                 [       1.00 GiB] 
  4 disks
  3 partitions
  0 LVM physical volume whole disks
  1 LVM physical volume
]0;root@lvm:~[root@lvm ~]# pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
]0;root@lvm:~[root@lvm ~]# vgcreate otus /dev/sdb
  Volume group "otus" successfully created
]0;root@lvm:~[root@lvm ~]# lvcreate -l+80%FREE -n test otus
  Logical volume "test" created.
]0;root@lvm:~[root@lvm ~]# vgdisplay otus
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10.00 GiB
  PE Size               4.00 MiB
  Total PE              2559
  Alloc PE / Size       2047 / <8.00 GiB
  Free  PE / Size       512 / 2.00 GiB
  VG UUID               eQ9u43-WJk5-2RN8-eA3r-HIbR-ht75-ngxO1D
   
]0;root@lvm:~[root@lvm ~]# vgdisplay -v otus | grep 'PV NAME'
]0;root@lvm:~[root@lvm ~]# lvdisplay /dev/otus/test
  --- Logical volume ---
  LV Path                /dev/otus/test
  LV Name                test
  VG Name                otus
  LV UUID                BZAzcw-arOt-cF7F-jeM5-twKy-iHlP-Lp7fS0
  LV Write Access        read/write
  LV Creation host, time lvm, 2023-04-12 03:40:51 +0000
  LV Status              available
  # open                 0
  LV Size                <8.00 GiB
  Current LE             2047
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
]0;root@lvm:~[root@lvm ~]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree
  VolGroup00   1   2   0 wz--n- <38.97g    0 
  otus         1   1   0 wz--n- <10.00g 2.00g
]0;root@lvm:~[root@lvm ~]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao---- <37.47g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  test     otus       -wi-a-----  <8.00g                                                    
]0;root@lvm:~[root@lvm ~]# lvcreate -L100M -n small otus
  Logical volume "small" created.
]0;root@lvm:~[root@lvm ~]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao---- <37.47g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  small    otus       -wi-a----- 100.00m                                                    
  test     otus       -wi-a-----  <8.00g                                                    
]0;root@lvm:~[root@lvm ~]# mkfs.ext4 /dev/otus/test
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
524288 inodes, 2096128 blocks
104806 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2147483648
64 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables:  0/64     done                            
Writing inode tables:  0/64     done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information:  0/64     done

]0;root@lvm:~[root@lvm ~]# mkdir /data
]0;root@lvm:~[root@lvm ~]# mount /dev/otus/test /data/
]0;root@lvm:~[root@lvm ~]# mount | grep /data
/dev/mapper/otus-test on [01;31m[K/data[m[K type ext4 (rw,relatime,seclabel,data=ordered)
]0;root@lvm:~[root@lvm ~]# pvcreate /dev/sdc
  Physical volume "/dev/sdc" successfully created.
]0;root@lvm:~[root@lvm ~]# vgextend otus /dev/sdc
  Volume group "otus" successfully extended
]0;root@lvm:~[root@lvm ~]# vgdisplay -v otus | grep 'PV Name'
  [01;31m[KPV Name[m[K               /dev/sdb     
  [01;31m[KPV Name[m[K               /dev/sdc     
]0;root@lvm:~[root@lvm ~]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree 
  VolGroup00   1   2   0 wz--n- <38.97g     0 
  otus         2   2   0 wz--n-  11.99g <3.90g
]0;root@lvm:~[root@lvm ~]# dd if=/dev/zero of=/data/test.log bs=1M count=8000 status=progress
120586240 bytes (121 MB) copied, 1.028079 s, 117 MB/s208666624 bytes (209 MB) copied, 2.085669 s, 100 MB/s360710144 bytes (361 MB) copied, 3.091629 s, 117 MB/s471859200 bytes (472 MB) copied, 4.097827 s, 115 MB/s599785472 bytes (600 MB) copied, 5.098000 s, 118 MB/s674234368 bytes (674 MB) copied, 6.107285 s, 110 MB/s751828992 bytes (752 MB) copied, 7.120476 s, 106 MB/s789577728 bytes (790 MB) copied, 8.371268 s, 94.3 MB/s877658112 bytes (878 MB) copied, 9.377043 s, 93.6 MB/s962592768 bytes (963 MB) copied, 10.384254 s, 92.7 MB/s1029701632 bytes (1.0 GB) copied, 11.475864 s, 89.7 MB/s1139802112 bytes (1.1 GB) copied, 12.492438 s, 91.2 MB/s1231028224 bytes (1.2 GB) copied, 13.510374 s, 91.1 MB/s1302331392 bytes (1.3 GB) copied, 14.714598 s, 88.5 MB/s1379926016 bytes (1.4 GB) copied, 15.720139 s, 87.8 MB/s1452277760 bytes (1.5 GB) copied, 16.728202 s, 86.8 MB/s1530920960 bytes (1.5 GB) copied, 17.788519 s, 86.1 MB/s1608515584 bytes (1.6 GB) copied, 18.793045 s, 85.6 MB/s1677721600 bytes (1.7 GB) copied, 19.794628 s, 84.8 MB/s1750073344 bytes (1.8 GB) copied, 20.813302 s, 84.1 MB/s1873805312 bytes (1.9 GB) copied, 21.813319 s, 85.9 MB/s1996488704 bytes (2.0 GB) copied, 22.813383 s, 87.5 MB/s2139095040 bytes (2.1 GB) copied, 23.826756 s, 89.8 MB/s2273312768 bytes (2.3 GB) copied, 24.830797 s, 91.6 MB/s2385510400 bytes (2.4 GB) copied, 25.834951 s, 92.3 MB/s2469396480 bytes (2.5 GB) copied, 26.837366 s, 92.0 MB/s2578448384 bytes (2.6 GB) copied, 27.844456 s, 92.6 MB/s2714763264 bytes (2.7 GB) copied, 28.855438 s, 94.1 MB/s2842689536 bytes (2.8 GB) copied, 29.856989 s, 95.2 MB/s2966421504 bytes (3.0 GB) copied, 30.864314 s, 96.1 MB/s3102736384 bytes (3.1 GB) copied, 31.875879 s, 97.3 MB/s3224371200 bytes (3.2 GB) copied, 32.884263 s, 98.1 MB/s3340763136 bytes (3.3 GB) copied, 33.895627 s, 98.6 MB/s3460300800 bytes (3.5 GB) copied, 34.907042 s, 99.1 MB/s3592421376 bytes (3.6 GB) copied, 35.912178 s, 100 MB/s3717201920 bytes (3.7 GB) copied, 36.969376 s, 101 MB/s3861905408 bytes (3.9 GB) copied, 37.971617 s, 102 MB/s3989831680 bytes (4.0 GB) copied, 38.979245 s, 102 MB/s4113563648 bytes (4.1 GB) copied, 39.987932 s, 103 MB/s4248829952 bytes (4.2 GB) copied, 40.989750 s, 104 MB/s4355784704 bytes (4.4 GB) copied, 42.034297 s, 104 MB/s4527751168 bytes (4.5 GB) copied, 43.034650 s, 105 MB/s4682940416 bytes (4.7 GB) copied, 44.039741 s, 106 MB/s4842323968 bytes (4.8 GB) copied, 45.042533 s, 108 MB/s4920967168 bytes (4.9 GB) copied, 46.052657 s, 107 MB/s4980736000 bytes (5.0 GB) copied, 47.056199 s, 106 MB/s5056233472 bytes (5.1 GB) copied, 48.062210 s, 105 MB/s5118099456 bytes (5.1 GB) copied, 49.141797 s, 104 MB/s5206179840 bytes (5.2 GB) copied, 50.158411 s, 104 MB/s5372903424 bytes (5.4 GB) copied, 51.167964 s, 105 MB/s5517606912 bytes (5.5 GB) copied, 52.178744 s, 106 MB/s5659164672 bytes (5.7 GB) copied, 53.184762 s, 106 MB/s5783945216 bytes (5.8 GB) copied, 54.184872 s, 107 MB/s5916065792 bytes (5.9 GB) copied, 55.186150 s, 107 MB/s6034554880 bytes (6.0 GB) copied, 56.192560 s, 107 MB/s6164578304 bytes (6.2 GB) copied, 57.206426 s, 108 MB/s6306136064 bytes (6.3 GB) copied, 58.209000 s, 108 MB/s6434062336 bytes (6.4 GB) copied, 59.222495 s, 109 MB/s6564085760 bytes (6.6 GB) copied, 60.230791 s, 109 MB/s6694109184 bytes (6.7 GB) copied, 61.234908 s, 109 MB/s6828326912 bytes (6.8 GB) copied, 62.238597 s, 110 MB/s6958350336 bytes (7.0 GB) copied, 63.247958 s, 110 MB/s7086276608 bytes (7.1 GB) copied, 64.255592 s, 110 MB/s7225737216 bytes (7.2 GB) copied, 65.266723 s, 111 MB/s7349469184 bytes (7.3 GB) copied, 66.276496 s, 111 MB/s7453278208 bytes (7.5 GB) copied, 67.315452 s, 111 MB/s7528775680 bytes (7.5 GB) copied, 68.315529 s, 110 MB/s7595884544 bytes (7.6 GB) copied, 69.327239 s, 110 MB/s7669284864 bytes (7.7 GB) copied, 70.328881 s, 109 MB/s7755268096 bytes (7.8 GB) copied, 71.332333 s, 109 MB/s7829716992 bytes (7.8 GB) copied, 72.400245 s, 108 MB/s7890534400 bytes (7.9 GB) copied, 73.419510 s, 107 MB/s7950303232 bytes (8.0 GB) copied, 74.420571 s, 107 MB/s8043626496 bytes (8.0 GB) copied, 75.435219 s, 107 MB/s8134852608 bytes (8.1 GB) copied, 76.440304 s, 106 MB/s8208252928 bytes (8.2 GB) copied, 77.440404 s, 106 MB/s
dd: error writing â€˜/data/test.logâ€™: No space left on device
7880+0 records in
7879+0 records out
8262189056 bytes (8.3 GB) copied, 78.1523 s, 106 MB/s
]0;root@lvm:~[root@lvm ~]# df -Th /data/
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  7.8G  7.8G     0 100% /data
]0;root@lvm:~[root@lvm ~]# lvextend -l+80%FREE /dev/otus/test
  Size of logical volume otus/test changed from <8.00 GiB (2047 extents) to <11.12 GiB (2846 extents).
  Logical volume otus/test successfully resized.
]0;root@lvm:~[root@lvm ~]# lvs /dev/otus/test
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test otus -wi-ao---- <11.12g                                                    
]0;root@lvm:~[root@lvm ~]# df -Th /data/
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  7.8G  7.8G     0 100% /data
]0;root@lvm:~[root@lvm ~]# umount /data/
]0;root@lvm:~[root@lvm ~]# e2fsck -fy /dev/otus/test
e2fsck 1.42.9 (28-Dec-2013)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/otus/test: 12/524288 files (0.0% non-contiguous), 2092032/2096128 blocks
]0;root@lvm:~[root@lvm ~]# resize2fs /dev/otus/test 10G
resize2fs 1.42.9 (28-Dec-2013)
Resizing the filesystem on /dev/otus/test to 2621440 (4k) blocks.
The filesystem on /dev/otus/test is now 2621440 blocks long.

]0;root@lvm:~[root@lvm ~]# lvreduce /dev/otus/test -L 10G
  WARNING: Reducing active logical volume to 10.00 GiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce otus/test? [y/n]: y
  Size of logical volume otus/test changed from <11.12 GiB (2846 extents) to 10.00 GiB (2560 extents).
  Logical volume otus/test successfully resized.
]0;root@lvm:~[root@lvm ~]# mount /dev/otus/test /data/
]0;root@lvm:~[root@lvm ~]# df -Th /data/
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  9.8G  7.8G  1.5G  84% /data
]0;root@lvm:~[root@lvm ~]# lvs /dev/otus/test
  LV   VG   Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test otus -wi-ao---- 10.00g                                                    
]0;root@lvm:~[root@lvm ~]# lvcreate -L 500M -s -n test-snap /dev/otus/test
  Logical volume "test-snap" created.
]0;root@lvm:~[root@lvm ~]# vgs -o +lv_size,lv_name | grep test
  otus         2   3   1 wz--n-  11.99g <1.41g  10.00g [01;31m[Ktest[m[K     
  otus         2   3   1 wz--n-  11.99g <1.41g 500.00m [01;31m[Ktest[m[K-snap
]0;root@lvm:~[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
â”œâ”€sda1                    8:1    0    1M  0 part 
â”œâ”€sda2                    8:2    0    1G  0 part /boot
â””â”€sda3                    8:3    0   39G  0 part 
  â”œâ”€VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  â””â”€VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
â”œâ”€otus-small            253:3    0  100M  0 lvm  
â””â”€otus-test-real        253:4    0   10G  0 lvm  
  â”œâ”€otus-test           253:2    0   10G  0 lvm  /data
  â””â”€otus-test--snap     253:6    0   10G  0 lvm  
sdc                       8:32   0    2G  0 disk 
â”œâ”€otus-test-real        253:4    0   10G  0 lvm  
â”‚ â”œâ”€otus-test           253:2    0   10G  0 lvm  /data
â”‚ â””â”€otus-test--snap     253:6    0   10G  0 lvm  
â””â”€otus-test--snap-cow   253:5    0  500M  0 lvm  
  â””â”€otus-test--snap     253:6    0   10G  0 lvm  
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
]0;root@lvm:~[root@lvm ~]# mkdir /data-snap
]0;root@lvm:~[root@lvm ~]# mount /dev/otus/test-snap /data-snap/
]0;root@lvm:~[root@lvm ~]# ll /data-snap/
total 8068564
drwx------. 2 root root      16384 Apr 12 03:41 [0m[01;34mlost+found[0m
-rw-r--r--. 1 root root 8262189056 Apr 12 03:44 test.log
]0;root@lvm:~[root@lvm ~]# rm /data-snap/test.log
rm: remove regular file â€˜/data-snap/test.logâ€™? y
]0;root@lvm:~[root@lvm ~]# umount /data-snap
]0;root@lvm:~[root@lvm ~]# umount /data
]0;root@lvm:~[root@lvm ~]# lvconvert --merge /dev/otus/test-snap
  Merging of volume otus/test-snap started.
  otus/test: Merged: 100.00%
]0;root@lvm:~[root@lvm ~]# mount /dev/otus/test /data
]0;root@lvm:~[root@lvm ~]# ll /data
total 16
drwx------. 2 root root 16384 Apr 12 03:41 [0m[01;34mlost+found[0m
]0;root@lvm:~[root@lvm ~]# pvcreate /dev/sd{d,e}
  Physical volume "/dev/sdd" successfully created.
  Physical volume "/dev/sde" successfully created.
]0;root@lvm:~[root@lvm ~]# vgcreate vg0 /dev/sd{d,e}
  Volume group "vg0" successfully created
]0;root@lvm:~[root@lvm ~]# lvcreate -l+80%FREE -m1 -n mirror vg0
  Logical volume "mirror" created.
]0;root@lvm:~[root@lvm ~]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao---- <37.47g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  small    otus       -wi-a----- 100.00m                                                    
  test     otus       -wi-ao----  10.00g                                                    
  mirror   vg0        rwi-a-r--- 816.00m                                    100.00          
]0;root@lvm:~[root@lvm ~]# exit
logout
]0;vagrant@lvm:~[vagrant@lvm ~]$ exit
logout
Connection to 127.0.0.1 closed.
]0;garik@garik-VirtualBox: ~/VG/CentOS1garik@garik-VirtualBox:~/VG/CentOS1$ exit
exit

Script done on 2023-04-12 10:50:30+07:00 [COMMAND_EXIT_CODE="0"]
